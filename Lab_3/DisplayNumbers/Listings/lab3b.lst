


ARM Macro Assembler    Page 1 


    1 00000000         ; This code is based upon InputOutput's from the book:
    2 00000000         ;  "Embedded Systems: Introduction to ARM Cortex M Micro
                       controllers"
    3 00000000         ;  ISBN: 978-1469998749, Jonathan Valvano, copyright (c)
                        2014
    4 00000000         ;
    5 00000000         ; The code provided initializes all 3 ports (A,B,E) with
                        the ECE Shield plugged into the Tiva board
    6 00000000         ; Port F with the Tiva 3 LEDs (Red, Green, Blue) and two
                        buttons is also initialized
    7 00000000         ; Then the LEDs on each port are turned off and on with 
                       time delays - while the Tiva board R, G, B LEDs are turn
                       ed on and off
    8 00000000         ;
    9 00000000         ; Dec 2017
   10 00000000         
   11 00000000                 AREA             |.text|, CODE, READONLY, ALIGN=
2
   12 00000000                 THUMB
   13 00000000                 EXPORT           Start
   14 00000000         
   15 00000000         ; These equates allow one to associate a name with a val
                       ue to make the code more readable
   16 00000000         
   17 00000000 00000002 
                       RED     EQU              0x02        ; These are the val
                                                            ues (bit locations)
                                                             for various LEDs o
                                                            n the Tiva (Port F)
                                                            
   18 00000000 00000004 
                       BLUE    EQU              0x04
   19 00000000 00000008 
                       GREEN   EQU              0x08
   20 00000000 00000010 
                       SW1     EQU              0x10        ; on the left side 
                                                            of the Tiva board
   21 00000000 00000001 
                       SW2     EQU              0x01        ; on the right side
                                                             of the Tiva board
   22 00000000         
   23 00000000         Start
   24 00000000 F000 F844       BL               Port_Init   ; initialize input 
                                                            and output pins of 
                                                            Ports A to F
   25 00000004 4C4E            LDR              R4, =GPIO_PORTF_DATA_R ; pointe
                                                            r to Port F data re
                                                            gister
   26 00000006         ;turn off 7 port B LEDs on the shielf - the last LED is 
                       on Port E
   27 00000006 4B4F            LDR              R3, =GPIO_PORTB + (PORT_B_MASK 
<< 2) 
                                                            ; generate the base
                                                             address for port B
                                                            
   28 00000008 F04F 0100       MOV              R1, #0      ; write out a 0 to 
                                                            turn off the 7 LEDs
                                                             on port B
   29 0000000C 6019            STR              R1, [R3, #GPIO_DATA_OFFSET] ; G



ARM Macro Assembler    Page 2 


                                                            PIO_DATA_OFFSET is 
                                                            the address offset 
                                                            to get to the DATA 
                                                            part of the port
   30 0000000E         
   31 0000000E         ; The last LED is on port E - so read the value, modify 
                       bit 1 as it drives the LED and write it back out - this 
                       is called read-modify-write
   32 0000000E 4B4E            LDR              R3, =GPIO_PORTE + (PORT_E_MASK 
<< 2) 
                                                            ; generate the base
                                                             address for port E
                                                            
   33 00000010 6819            LDR              R1, [R3, #GPIO_DATA_OFFSET] ; G
                                                            PIO_DATA_OFFSET is 
                                                            the address offset 
                                                            to get to the DATA 
                                                            part of the port
   34 00000012 F001 01FD       AND              R1, #0xFD   ; set E1 0 to turn 
                                                            that LED off
   35 00000016 6019            STR              R1, [R3, #GPIO_DATA_OFFSET] ; w
                                                            rite the data back 
                                                            out
   36 00000018         
   37 00000018 00086470 
                       SHORTDELAYCOUNT
                               EQU              550000      ; fraction of a sec
                                                            ond delay ;;ORIGINA
                                                            LLY 550000
   38 00000018         ; This number was changed from 400 to 550
   39 00000018         
   40 00000018         Counter
   41 00000018 F04F 0500       MOV              R5, #0      ; Reset R5
   42 0000001C         counterouterloop
   43 0000001C 484B            LDR              R0, =SHORTDELAYCOUNT ; Store th
                                                            e value of the SHOR
                                                            TDELAYCOUNT into R0
                                                            
   44 0000001E         counterdelay
   45 0000001E 1E40            SUBS             R0, R0, #1  ; R0 = R0 - 1 (coun
                                                            t = count - 1) and 
                                                            set N, Z, C status 
                                                            bits
   46 00000020 F090 0F00       TEQ              R0, #0      ; Check if R0 is eq
                                                            ual to 0. If not, g
                                                            o back to counterde
                                                            lay
   47 00000024 D1FB            BNE              counterdelay ; If it is not equ
                                                            al to 0, go back to
                                                             counterdelay
   48 00000026 F000 F806       BL               Display     ; Display the numbe
                                                            r
   49 0000002A F105 0501       ADD              R5, R5, #1  ; Add one to R5
   50 0000002E F495 7F80       TEQ              R5, #0x0100 ; Check if R5 is eq
                                                            ual to 0xFF. If not
                                                            , go back to counte
                                                            router loop
   51 00000032 D1F3            BNE              counterouterloop
   52 00000034 E7F0            B                Counter     ; Branch to Counter



ARM Macro Assembler    Page 3 


                                                            
   53 00000036         
   54 00000036         Display
   55 00000036 B53F            STMFD            R13!,{R0, R1, R2, R3, R4, R5, R
14} 
                                                            ;
   56 00000038         Displayloop
   57 00000038 4B42            LDR              R3, =GPIO_PORTB + (PORT_B_MASK 
<< 2) 
                                                            ; generate the base
                                                             address for port B
                                                            
   58 0000003A 601D            STR              R5, [R3, #GPIO_DATA_OFFSET] ; G
                                                            PIO_DATA_OFFSET is 
                                                            the address offset 
                                                            to get to the DATA 
                                                            part of the port. S
                                                            tore R5 into the LE
                                                            D+GPIO_DATA_OFFSET
   59 0000003C         
   60 0000003C         ; The last LED is on port E - so read the value, modify 
                       bit 1 as it drives the LED and write it back out - this 
                       is called read-modify-write
   61 0000003C 4B42            LDR              R3, =GPIO_PORTE + (PORT_E_MASK 
<< 2) 
                                                            ; generate the base
                                                             address for port E
                                                            
   62 0000003E 6819            LDR              R1, [R3, #GPIO_DATA_OFFSET] ; G
                                                            PIO_DATA_OFFSET is 
                                                            the address offset 
                                                            to get to the DATA 
                                                            part of the port
   63 00000040 F001 01FD       AND              R1, #0xFD   ; set B1 0 to turn 
                                                            that LED off
   64 00000044 EA41 0105       ORR              R1, R5      ; set E1 - these tw
                                                            o lines could be re
                                                            placed with a singl
                                                            e ORR statement
   65 00000048 6019            STR              R1, [R3, #GPIO_DATA_OFFSET] ; w
                                                            rite the data back 
                                                            out
   66 0000004A         
   67 0000004A BD3F            LDMFD            R13!,{R0,R1, R2, R3, R4, R5, R1
5} 
                                                            ; pull the LR or re
                                                            turn address and re
                                                            turn
   68 0000004C         
   69 0000004C         
   70 0000004C         
   71 0000004C         ; * * * * * * * * * * * * * * * * * * * * * * * * * * * 
                       * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
                       * * * * * * * * * 
   72 0000004C         ;   DO NOT EDIT CODE BELOW THIS LINE
   73 0000004C         ; * * * * * * * * * * * * * * * * * * * * * * * * * * * 
                       * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
                       * * * * * * * * * 
   74 0000004C         



ARM Macro Assembler    Page 4 


   75 0000004C         ;------------RandomNum------------
   76 0000004C         ; R11 holds a 16-bit "random" number via a pseudo-random
                        sequence as per the Linear feedback shift register (Fib
                       onacci) on WikiPedia
   77 0000004C         ; Take as many bits of R11 as you need.
   78 0000004C         ;
   79 0000004C         ; R11 can be read anywhere in the user code but must onl
                       y be written to by this subroutine
   80 0000004C         ;
   81 0000004C         ; INPUT: R11 - before calling this for the FIRST time R1
                       1 must be initialized to a large 16-bit non-zero value
   82 0000004C         ;      if R11 is ever set to 0 then R11 will stay stuck 
                       at zero
   83 0000004C         ; OUTPUT: R11 - random number is the lowest 16 bits of R
                       11 which is between 1 and 0xffff
   84 0000004C         ;
   85 0000004C B50E    RandomNum
                               STMFD            R13!,{R1, R2, R3, R14}
   86 0000004E         
   87 0000004E F40B 4100       AND              R1, R11, #0x8000
   88 00000052 F40B 5200       AND              R2, R11, #0x2000
   89 00000056 EA4F 0282       LSL              R2, #2
   90 0000005A EA81 0302       EOR              R3, R1, R2
   91 0000005E F40B 5180       AND              R1, R11, #0x1000
   92 00000062 EA4F 01C1       LSL              R1, #3
   93 00000066 EA83 0301       EOR              R3, R3, R1
   94 0000006A F40B 6180       AND              R1, R11, #0x0400
   95 0000006E EA4F 1141       LSL              R1, #5
   96 00000072 EA83 0301       EOR              R3, R3, R1  ; the new bit to go
                                                             into the LSB is pr
                                                            esent
   97 00000076 EA4F 33D3       LSR              R3, #15
   98 0000007A EA4F 0B4B       LSL              R11, #1
   99 0000007E EA4B 0B03       ORR              R11, R11, R3
  100 00000082 F64F 71FF       MOV              R1, #0xFFFF
  101 00000086 EA0B 0B01       AND              R11, R1     ; clear the upper 1
                                                            6 bits of R11 as th
                                                            ey're not part of t
                                                            he random #
  102 0000008A         
  103 0000008A BD0E            LDMFD            R13!,{R1, R2, R3, R15}
  104 0000008C         
  105 0000008C         
  106 0000008C         ; Tons of initialization to be done in order to use the 
                       I/O ports as they're off by default.
  107 0000008C         ;
  108 0000008C         ; Define the addresses and provide functions to initiali
                       ze everything.
  109 0000008C         
  110 0000008C 40025400 
                       GPIO_PORTF_DIR_R
                               EQU              0x40025400  ; Port F Data Direc
                                                            tion Register setti
                                                            ng pins as input or
                                                             output
  111 0000008C 400253FC 
                       GPIO_PORTF_DATA_R
                               EQU              0x400253FC  ; address for readi
                                                            ng button inputs an



ARM Macro Assembler    Page 5 


                                                            d writing to LEDs
  112 0000008C 40025420 
                       GPIO_PORTF_AFSEL_R
                               EQU              0x40025420
  113 0000008C 40025510 
                       GPIO_PORTF_PUR_R
                               EQU              0x40025510
  114 0000008C 4002551C 
                       GPIO_PORTF_DEN_R
                               EQU              0x4002551C
  115 0000008C 40025520 
                       GPIO_PORTF_LOCK_R
                               EQU              0x40025520
  116 0000008C 40025524 
                       GPIO_PORTF_CR_R
                               EQU              0x40025524
  117 0000008C 40025528 
                       GPIO_PORTF_AMSEL_R
                               EQU              0x40025528
  118 0000008C 4002552C 
                       GPIO_PORTF_PCTL_R
                               EQU              0x4002552C
  119 0000008C         
  120 0000008C         ;Section 3.1.2 Nested Vector Interrupt Controller
  121 0000008C         
  122 0000008C         ;The Cortex-M4F processor supports interrupts and system
                        exceptions. The processor and the
  123 0000008C         ;Nested Vectored Interrupt Controller (NVIC) prioritize 
                       and handle all exceptions. An exception
  124 0000008C         ;changes the normal flow of software control. The proces
                       sor uses Handler mode to handle all
  125 0000008C         ;exceptions except for reset. See “Exception Entry and R
                       eturn” on page 108 for more information.
  126 0000008C         ;The NVIC registers control interrupt handling. See “Nes
                       ted Vectored Interrupt Controller
  127 0000008C         ;(NVIC)” on page 124 for more information.
  128 0000008C         
  129 0000008C         ;Table 3-8 on page 134 details interrupt Set / Clear 
  130 0000008C         ; they allow one to enable individual interrupts and DIS
                       ? lets one disable individual interrupt numbers
  131 0000008C         
  132 0000008C         ; Table 2-9 Interrupts on page 104 details interrupt num
                       ber / bit assignments
  133 0000008C         ; Port F - Bit 30
  134 0000008C         ; Timer 0A Bit 19
  135 0000008C         ; Timer 0B Bit 20
  136 0000008C         
  137 0000008C         ;For edge-triggered interrupts, software must clear the 
                       interrupt to enable any further interrupts.
  138 0000008C         
  139 0000008C         ; NOTE: The NMI (non-maskable interrupt) is on PF0.  Tha
                       t means that
  140 0000008C         ; the Alternate Function Select, Pull-Up Resistor, Pull-
                       Down Resistor,
  141 0000008C         ; and Digital Enable are all locked for PF0 until a valu
                       e of 0x4C4F434B
  142 0000008C         ; is written to the Port F GPIO Lock Register.  After Po
                       rt F is
  143 0000008C         ; unlocked, bit 0 of the Port F GPIO Commit Register mus



ARM Macro Assembler    Page 6 


                       t be set to
  144 0000008C         ; allow access to PF0's control registers.  On the LM4F1
                       20, the other
  145 0000008C         ; bits of the Port F GPIO Commit Register are hard-wired
                        to 1, meaning
  146 0000008C         ; that the rest of Port F can always be freely re-config
                       ured at any
  147 0000008C         ; time.  Requiring this procedure makes it unlikely to a
                       ccidentally
  148 0000008C         ; re-configure the JTAG and NMI pins as GPIO, which can 
                       lock the
  149 0000008C         ; debugger out of the processor and make it permanently 
                       unable to be
  150 0000008C         ; debugged or re-programmed.
  151 0000008C         
  152 0000008C         ; These are the configuration registers which should not
                        be touched
  153 0000008C         ; Port Base addresses for the legacy (not high-performan
                       ce) interface to I/O ports
  154 0000008C 40004000 
                       GPIO_PORTA
                               EQU              0x40004000
  155 0000008C 40005000 
                       GPIO_PORTB
                               EQU              0x40005000
  156 0000008C 40006000 
                       GPIO_PORTC
                               EQU              0x40006000
  157 0000008C 40007000 
                       GPIO_PORTD
                               EQU              0x40007000
  158 0000008C 40024000 
                       GPIO_PORTE
                               EQU              0x40024000
  159 0000008C 40025000 
                       GPIO_PORTF
                               EQU              0x40025000
  160 0000008C         
  161 0000008C         ; WARNING outputs PD0 & PD1 are shorted to PB6 and PB7 -
                        one pair MUST BE INPUTS!! - we disable D0, D1
  162 0000008C         
  163 0000008C         ; These are the masks for pins which are outputs, settin
                       g a bit to 1 makes the pin an output, 0 is input
  164 0000008C 000000FC 
                       PORT_A_MASK
                               EQU              0xfc        ; PA7,6,5,4,3,2 are
                                                             outputs for 7-segm
                                                            ent LEDs
  165 0000008C 000000FD 
                       PORT_B_MASK
                               EQU              0xfd        ; PB7,6,5,4,3,2,0 a
                                                            re LEDs
  166 0000008C 00000030 
                       PORT_C_MASK
                               EQU              0x30        ; this breaks progr
                                                            amming the CPU - DO
                                                             NOT ENABLE 
  167 0000008C 000000CC 
                       PORT_D_MASK



ARM Macro Assembler    Page 7 


                               EQU              0xcc        ; PD7,6,3,2  Disabl
                                                            e D0, D1 due to sho
                                                            rt with B6, B7
  168 0000008C 00000037 
                       PORT_E_MASK
                               EQU              0x37        ; PE0,1,2,4,5 are u
                                                            sed for 7-segment, 
                                                            LED & speaker
  169 0000008C 0000000E 
                       PORT_F_MASK
                               EQU              0x0e        ; PF has LEDs on PF
                                                            1,2,3 and buttons P
                                                            F0, PF4 (don't enab
                                                            le buttons as outpu
                                                            ts)
  170 0000008C         
  171 0000008C         
  172 0000008C         ; Offsets are from table 10-6 on page 660
  173 0000008C 00000000 
                       GPIO_DATA_OFFSET
                               EQU              0x000       ; Data address is t
                                                            he base address - Y
                                                            OU HAVE TO ADD AN A
                                                            DDRESS MASK TOO to 
                                                            read or write this!
                                                            !
  174 0000008C 00000400 
                       GPIO_DIR_OFFSET
                               EQU              0x400       ; Direction registe
                                                            r
  175 0000008C 00000420 
                       GPIO_AFSEL_OFFSET
                               EQU              0x420       ; Alternate Functio
                                                            n SELection
  176 0000008C 00000510 
                       GPIO_PUR_OFFSET
                               EQU              0x510       ; Pull Up Resistors
                                                            
  177 0000008C 0000051C 
                       GPIO_DEN_OFFSET
                               EQU              0x51C       ; Digital ENable
  178 0000008C 00000520 
                       GPIO_LOCK_OFFSET
                               EQU              0x520
  179 0000008C 00000524 
                       GPIO_CR_OFFSET
                               EQU              0x524
  180 0000008C 00000528 
                       GPIO_AMSEL_OFFSET
                               EQU              0x528       ; Analog Mode SELec
                                                            t
  181 0000008C 0000052C 
                       GPIO_PCTL_OFFSET
                               EQU              0x52C
  182 0000008C         
  183 0000008C 400FE06C 
                       SYSCTL_HBCTL
                               EQU              0x400FE06C  ; high performance 
                                                            bus control for por



ARM Macro Assembler    Page 8 


                                                            ts A to F
  184 0000008C         
  185 0000008C 4C4F434B 
                       GPIO_LOCK_KEY
                               EQU              0x4C4F434B  ; Unlocks the GPIO_
                                                            CR register
  186 0000008C 400FE608 
                       SYSCTL_RCGCGPIO_R
                               EQU              0x400FE608  ; Register to enabl
                                                            e clocks to the I/O
                                                             port hardware
  187 0000008C         
  188 0000008C         ;------------Port_Init------------
  189 0000008C         ; Initialize GPIO Port F for negative logic switches on 
                       PF0 and
  190 0000008C         ; PF4 as the Launchpad is wired.  Weak internal pull-up
  191 0000008C         ; resistors are enabled, and the NMI functionality on PF
                       0 is
  192 0000008C         ; disabled.  Make the RGB LED's pins outputs.
  193 0000008C         ; Input: none
  194 0000008C         ; Output: none
  195 0000008C         ; Modifies: R0, R1, R2, R3
  196 0000008C         Port_Init
  197 0000008C B500            STMFD            R13!,{R14}  ; push the LR or re
                                                            turn address
  198 0000008E         
  199 0000008E         ; First enable the clock to the I/O ports, by default th
                       e clocks are off to save power
  200 0000008E         ; If a clock is not enabled to a port and you access it 
                       - then the processor hard faults
  201 0000008E 4932            LDR              R1, =SYSCTL_RCGCGPIO_R ; activa
                                                            te clock for Ports 
                                                            (see page 340)
  202 00000090 6808            LDR              R0, [R1]
  203 00000092 F040 003F       ORR              R0, R0, #0x3F ; turn on clock t
                                                            o all 6 ports (A to
                                                             F, bits 0 to 5)
  204 00000096 6008            STR              R0, [R1]
  205 00000098 BF00            NOP
  206 0000009A BF00            NOP                          ; allow time for cl
                                                            ock to finish
  207 0000009C         
  208 0000009C         ; Set all ports to APB bus instead of AHB - this should 
                       be unnecessary
  209 0000009C         ; LDR R1, =SYSCTL_HBCTL
  210 0000009C         ; LDR R0, [R1]
  211 0000009C         ; AND R0, #0xFFFFFFE0  ; set Ports A thru F to APB (0) a
                       nd leave the rest at their default
  212 0000009C         ; STR R0, [R1]
  213 0000009C         
  214 0000009C         ; Page 650, Table 10-1 GPIO Pins with Special Considerat
                       ions.
  215 0000009C         ; These pins must be left as configured after reset:
  216 0000009C         ;  PA[5:0] (UART0 and SSIO), PB[3:2] (I2C), PC[3:0] (JTA
                       G)
  217 0000009C         
  218 0000009C         ; Initialize the I/O ports A, B, E, F via a common subro
                       utine Port_Init_Individual
  219 0000009C         ; Call Port_Init_Individual with the following paramater



ARM Macro Assembler    Page 9 


                       s passed:
  220 0000009C         ; R1 is the base port address
  221 0000009C         ; R2 is the output pin mask (which bits are outputs)
  222 0000009C         ; R3 is the input pin mask  (which bits get configured a
                       s inputs)
  223 0000009C         
  224 0000009C F04F 0300       MOV              R3, #0x00   ; Select no pins as
                                                             input (unless it's
                                                             changed as for por
                                                            t F)
  225 000000A0         
  226 000000A0         ; Init Port A, B, E are by default GPIO - set all output
                        pins used to a 1 to enable them
  227 000000A0         ;   and leave all of the other pins as previously config
                       ured!
  228 000000A0 F04F 2140       LDR              R1, =GPIO_PORTA
  229 000000A4 F04F 02FC       MOV              R2, #PORT_A_MASK ; enable commi
                                                            t for Port, 1 means
                                                             allow access
  230 000000A8 F000 F81A       BL               Port_Init_Individual
  231 000000AC         
  232 000000AC         ; Init Port B
  233 000000AC 492B            LDR              R1, =GPIO_PORTB
  234 000000AE F04F 02FD       MOV              R2, #PORT_B_MASK ; enable commi
                                                            t for Port, 1 means
                                                             allow access
  235 000000B2 F000 F815       BL               Port_Init_Individual
  236 000000B6         
  237 000000B6         ; Init Port C
  238 000000B6 492A            LDR              R1, =GPIO_PORTC
  239 000000B8 F04F 0230       MOV              R2, #PORT_C_MASK
  240 000000BC         ;BL Port_Init_Individual  ; Do not initialize Port C as 
                       it renders the Tiva board unprogramable !
  241 000000BC         
  242 000000BC         ; Init Port D
  243 000000BC 4929            LDR              R1, =GPIO_PORTD
  244 000000BE F04F 02CC       MOV              R2, #PORT_D_MASK
  245 000000C2 F000 F80D       BL               Port_Init_Individual
  246 000000C6         
  247 000000C6         ; Init Port E
  248 000000C6 4928            LDR              R1, =GPIO_PORTE
  249 000000C8 F04F 0237       MOV              R2, #PORT_E_MASK ; enable commi
                                                            t for Port, 1 means
                                                             allow access
  250 000000CC F000 F808       BL               Port_Init_Individual
  251 000000D0         
  252 000000D0         ; Init Port F
  253 000000D0 4926            LDR              R1, =GPIO_PORTF
  254 000000D2 F04F 020E       MOV              R2, #PORT_F_MASK ; enable commi
                                                            t for Port, 1 means
                                                             allow access
  255 000000D6 F04F 0311       MOV              R3, #0x11   ; enable weak pull-
                                                            up on PF0 and PF4 (
                                                            buttons)
  256 000000DA F000 F801       BL               Port_Init_Individual
  257 000000DE         
  258 000000DE BD00            LDMFD            R13!,{R15}  ; pull the LR or re
                                                            turn address from t
                                                            he stack and return



ARM Macro Assembler    Page 10 


                                                            
  259 000000E0         
  260 000000E0         
  261 000000E0         ;------------Port_Init_Individual------------
  262 000000E0         ; Initialize one GPIO Port with select bits as inputs an
                       d outputs
  263 000000E0         ; Output: none
  264 000000E0         ; Input: R1, R2, R3
  265 000000E0         ; R1 has to be the port address
  266 000000E0         ; R2 has to hold the mask for output pins
  267 000000E0         ; R3 has to be the mask for input pins
  268 000000E0         ; Modifies: R0
  269 000000E0         
  270 000000E0         Port_Init_Individual
  271 000000E0 B500            STMFD            R13!,{R14}  ; push the LR or re
                                                            turn address
  272 000000E2 4823            LDR              R0, =0x4C4F434B ; unlock GPIO P
                                                            ort F Commit Regist
                                                            er
  273 000000E4 F8C1 0520       STR              R0, [R1, #GPIO_LOCK_OFFSET] ; 2
                                                            ) unlock the lock r
                                                            egister
  274 000000E8 EA42 0003       ORR              R0, R2, R3  ; all access to inp
                                                            uts and outputs as 
                                                            masked in R2 and R3
                                                            
  275 000000EC F8C1 0524       STR              R0, [R1, #GPIO_CR_OFFSET] ; ena
                                                            ble commit for Port
                                                             F
  276 000000F0 F04F 0000       MOV              R0, #0      ; 0 means analog is
                                                             off
  277 000000F4 F8C1 0528       STR              R0, [R1, #GPIO_AMSEL_OFFSET] ; 
                                                            3) disable analog f
                                                            unctionality
  278 000000F8 F04F 0000       MOV              R0, #0x00000000 ; 0 means confi
                                                            gure Port F as GPIO
                                                            
  279 000000FC F8C1 052C       STR              R0, [R1, #GPIO_PCTL_OFFSET] ; 4
                                                            ) configure as GPIO
                                                            
  280 00000100 F8D1 0400       LDR              R0, [R1, #GPIO_DIR_OFFSET] ; 5)
                                                             read default direc
                                                            tion register confi
                                                            guration
  281 00000104 EA40 0002       ORR              R0, R2      ; ORR in only the b
                                                            its we want as outp
                                                            uts
  282 00000108 F8C1 0400       STR              R0, [R1, #GPIO_DIR_OFFSET] ; 5)
                                                             set direction regi
                                                            ster
  283 0000010C F04F 0000       MOV              R0, #0      ; 0 means disable a
                                                            lternate function 
  284 00000110 F8C1 0420       STR              R0, [R1, #GPIO_AFSEL_OFFSET] ; 
                                                            6) regular port fun
                                                            ction
  285 00000114 F8C1 3510       STR              R3, [R1, #GPIO_PUR_OFFSET] ; pu
                                                            ll-up resistors for
                                                             PF4,PF0
  286 00000118 F04F 00FF       MOV              R0, #0xFF   ; 1 means enable di



ARM Macro Assembler    Page 11 


                                                            gital I/O
  287 0000011C F8C1 051C       STR              R0, [R1, #GPIO_DEN_OFFSET]
  288 00000120 BD00            LDMFD            R13!,{R15}  ; pull the LR or re
                                                            turn address and re
                                                            turn
  289 00000122         
  290 00000122         ; Beep the speaker on the ECE Shield using port E4 and E
                       5
  291 00000122         ; The speaker is conencted to two pins - toggle each end
                        for more volume than a singled ended drive
  292 00000122         ;
  293 00000122         ; Before exiting ensure that both wires to the speaker a
                       re 0 to prevent it from being heated up
  294 00000122         ;
  295 00000122         ; Each beep, sounded or not, is about the same length - 
                       0x300 loops of delay loop
  296 00000122         ;
  297 00000122         ; Input: R1 sets the tone - 0 is NO BEEP,
  298 00000122         ;                           1 is a high pitch beep and l
                       arger numbers are lower pitched
  299 00000122         ; Output: none
  300 00000122         
  301 00000122         ;SpeakerBeepLength EQU 0x300   ; the length of the speak
                       er beep
  302 00000122         
  303 00000122         ;SpeakerBeep
  304 00000122         ; STMFD  R13!,{R1-R4, R11, R14}  ; push the LR or return
                        address
  305 00000122         ;
  306 00000122         ; MOV R4, #0x30  ; This xor'd with the port holding the 
                       speaker pins will create a beep
  307 00000122         ; TEQ R1, #0  ; If R1 = 0 then just delay but do not bee
                       p
  308 00000122         ; BNE make_a_sound
  309 00000122         ; MOV R1, #1  ; stick a valid value into R1 as 0 will di
                       vide by 0
  310 00000122         ; MOV R4, #0x0  ; setting R4 to 0 will ensure that no be
                       ep will sound
  311 00000122         ;make_a_sound
  312 00000122         ; MOV R3, #SpeakerBeepLength ; how many loops of the bee
                       p delay do we do?  Ie how long is the beep
  313 00000122         ; UDIV R3, R1  ; loop the tone R1 / R3 times to ensure a
                        total of 0x100 delays for all tones
  314 00000122         ; 
  315 00000122         ; LDR R2, =GPIO_PORTE + (PORT_E_MASK << 2)
  316 00000122         ; LDR R11, [R2, #GPIO_DATA_OFFSET]  ; get the initial va
                       lue - read-modify-write to only change 2 bits
  317 00000122         ; AND R11, #0xcf       ; clear two bits that the speaker
                        is on
  318 00000122         ; ORR R11, #0x10  ; initial speaker output (one side hig
                       h 0x10, the other low 0x20)
  319 00000122         ;buzz_loop
  320 00000122         ; BL ShortDelay   ; delay
  321 00000122         ; EOR R11, R4   ; xor to toggle the two speaker pins to 
                       create a beep
  322 00000122         ; STR R11, [R2, #GPIO_DATA_OFFSET]
  323 00000122         ; SUBS R3, #1
  324 00000122         ; BNE buzz_loop
  325 00000122         ; now power down the speaker



ARM Macro Assembler    Page 12 


  326 00000122         ; LDR R11, [R2, #GPIO_DATA_OFFSET]  ; restore the speake
                       r pins to 0V on each side
  327 00000122         ; AND R11, #0xcf       ; clear two bits that the speaker
                        is on
  328 00000122         ; STR R11, [R2, #GPIO_DATA_OFFSET]
  329 00000122         
  330 00000122         ; LDMFD  R13!,{R1-R4, R11, R15}  ; pull the LR or return
                        address and return
  331 00000122         
  332 00000122         
  333 00000122         ; ALIGN
  334 00000122         
  335 00000122         Port_Table
  336 00000122 00 00 400043F0  DCD              GPIO_PORTA + (PORT_A_MASK << 2)
 
                                                            ; DCD - Define Cons
                                                            tant Double Word (3
                                                            2-bits)
  337 00000128 400053F4 
              400060C0         DCD              GPIO_PORTB + (PORT_B_MASK << 2)
, GPIO_PORTC + (PORT_C_MASK << 2)
  338 00000130 40007330 
              400240DC         DCD              GPIO_PORTD + (PORT_D_MASK << 2)
, GPIO_PORTE + (PORT_E_MASK << 2)
  339 00000138 40025038 
              00000000         DCD              GPIO_PORTF + (PORT_F_MASK << 2)
, 0
  340 00000140         
  341 00000140                 ALIGN                        ; make sure the end
                                                             of this section is
                                                             aligned
  342 00000140                 END                          ; end of file - not
                                                            hing after this is 
                                                            assembled
              400253FC 
              400053F4 
              400240DC 
              00086470 
              00000000 
              00000000 
              400FE608 
              40005000 
              40006000 
              40007000 
              40024000 
              40025000 
              4C4F434B 
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M4.fp --apcs=int
erwork --depend=.\objects\lab3b.d -o.\objects\lab3b.o -I.\RTE\_Target_1 -IC:\Us
ers\navey\AppData\Local\Arm\Packs\Keil\TM4C_DFP\1.1.0\Device\Include\TM4C123 -I
C:\Keil_v5\ARM\CMSIS\Include --predefine="__EVAL SETA 1" --predefine="__UVISION
_VERSION SETA 528" --predefine="TM4C123GE6PM SETA 1" --list=.\listings\lab3b.ls
t lab3b.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

.text 00000000

Symbol: .text
   Definitions
      At line 11 in file lab3b.s
   Uses
      None
Comment: .text unused
Counter 00000018

Symbol: Counter
   Definitions
      At line 40 in file lab3b.s
   Uses
      At line 52 in file lab3b.s
Comment: Counter used once
Display 00000036

Symbol: Display
   Definitions
      At line 54 in file lab3b.s
   Uses
      At line 48 in file lab3b.s
Comment: Display used once
Displayloop 00000038

Symbol: Displayloop
   Definitions
      At line 56 in file lab3b.s
   Uses
      None
Comment: Displayloop unused
Port_Init 0000008C

Symbol: Port_Init
   Definitions
      At line 196 in file lab3b.s
   Uses
      At line 24 in file lab3b.s
Comment: Port_Init used once
Port_Init_Individual 000000E0

Symbol: Port_Init_Individual
   Definitions
      At line 270 in file lab3b.s
   Uses
      At line 230 in file lab3b.s
      At line 235 in file lab3b.s
      At line 245 in file lab3b.s
      At line 250 in file lab3b.s
      At line 256 in file lab3b.s

Port_Table 00000122

Symbol: Port_Table
   Definitions
      At line 335 in file lab3b.s
   Uses
      None



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

Comment: Port_Table unused
RandomNum 0000004C

Symbol: RandomNum
   Definitions
      At line 85 in file lab3b.s
   Uses
      None
Comment: RandomNum unused
Start 00000000

Symbol: Start
   Definitions
      At line 23 in file lab3b.s
   Uses
      At line 13 in file lab3b.s
Comment: Start used once
counterdelay 0000001E

Symbol: counterdelay
   Definitions
      At line 44 in file lab3b.s
   Uses
      At line 47 in file lab3b.s
Comment: counterdelay used once
counterouterloop 0000001C

Symbol: counterouterloop
   Definitions
      At line 42 in file lab3b.s
   Uses
      At line 51 in file lab3b.s
Comment: counterouterloop used once
11 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

BLUE 00000004

Symbol: BLUE
   Definitions
      At line 18 in file lab3b.s
   Uses
      None
Comment: BLUE unused
GPIO_AFSEL_OFFSET 00000420

Symbol: GPIO_AFSEL_OFFSET
   Definitions
      At line 175 in file lab3b.s
   Uses
      At line 284 in file lab3b.s
Comment: GPIO_AFSEL_OFFSET used once
GPIO_AMSEL_OFFSET 00000528

Symbol: GPIO_AMSEL_OFFSET
   Definitions
      At line 180 in file lab3b.s
   Uses
      At line 277 in file lab3b.s
Comment: GPIO_AMSEL_OFFSET used once
GPIO_CR_OFFSET 00000524

Symbol: GPIO_CR_OFFSET
   Definitions
      At line 179 in file lab3b.s
   Uses
      At line 275 in file lab3b.s
Comment: GPIO_CR_OFFSET used once
GPIO_DATA_OFFSET 00000000

Symbol: GPIO_DATA_OFFSET
   Definitions
      At line 173 in file lab3b.s
   Uses
      At line 29 in file lab3b.s
      At line 33 in file lab3b.s
      At line 35 in file lab3b.s
      At line 58 in file lab3b.s
      At line 62 in file lab3b.s
      At line 65 in file lab3b.s

GPIO_DEN_OFFSET 0000051C

Symbol: GPIO_DEN_OFFSET
   Definitions
      At line 177 in file lab3b.s
   Uses
      At line 287 in file lab3b.s
Comment: GPIO_DEN_OFFSET used once
GPIO_DIR_OFFSET 00000400

Symbol: GPIO_DIR_OFFSET
   Definitions
      At line 174 in file lab3b.s
   Uses



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols

      At line 280 in file lab3b.s
      At line 282 in file lab3b.s

GPIO_LOCK_KEY 4C4F434B

Symbol: GPIO_LOCK_KEY
   Definitions
      At line 185 in file lab3b.s
   Uses
      None
Comment: GPIO_LOCK_KEY unused
GPIO_LOCK_OFFSET 00000520

Symbol: GPIO_LOCK_OFFSET
   Definitions
      At line 178 in file lab3b.s
   Uses
      At line 273 in file lab3b.s
Comment: GPIO_LOCK_OFFSET used once
GPIO_PCTL_OFFSET 0000052C

Symbol: GPIO_PCTL_OFFSET
   Definitions
      At line 181 in file lab3b.s
   Uses
      At line 279 in file lab3b.s
Comment: GPIO_PCTL_OFFSET used once
GPIO_PORTA 40004000

Symbol: GPIO_PORTA
   Definitions
      At line 154 in file lab3b.s
   Uses
      At line 228 in file lab3b.s
      At line 336 in file lab3b.s

GPIO_PORTB 40005000

Symbol: GPIO_PORTB
   Definitions
      At line 155 in file lab3b.s
   Uses
      At line 27 in file lab3b.s
      At line 57 in file lab3b.s
      At line 233 in file lab3b.s
      At line 337 in file lab3b.s

GPIO_PORTC 40006000

Symbol: GPIO_PORTC
   Definitions
      At line 156 in file lab3b.s
   Uses
      At line 238 in file lab3b.s
      At line 337 in file lab3b.s

GPIO_PORTD 40007000

Symbol: GPIO_PORTD



ARM Macro Assembler    Page 3 Alphabetic symbol ordering
Absolute symbols

   Definitions
      At line 157 in file lab3b.s
   Uses
      At line 243 in file lab3b.s
      At line 338 in file lab3b.s

GPIO_PORTE 40024000

Symbol: GPIO_PORTE
   Definitions
      At line 158 in file lab3b.s
   Uses
      At line 32 in file lab3b.s
      At line 61 in file lab3b.s
      At line 248 in file lab3b.s
      At line 338 in file lab3b.s

GPIO_PORTF 40025000

Symbol: GPIO_PORTF
   Definitions
      At line 159 in file lab3b.s
   Uses
      At line 253 in file lab3b.s
      At line 339 in file lab3b.s

GPIO_PORTF_AFSEL_R 40025420

Symbol: GPIO_PORTF_AFSEL_R
   Definitions
      At line 112 in file lab3b.s
   Uses
      None
Comment: GPIO_PORTF_AFSEL_R unused
GPIO_PORTF_AMSEL_R 40025528

Symbol: GPIO_PORTF_AMSEL_R
   Definitions
      At line 117 in file lab3b.s
   Uses
      None
Comment: GPIO_PORTF_AMSEL_R unused
GPIO_PORTF_CR_R 40025524

Symbol: GPIO_PORTF_CR_R
   Definitions
      At line 116 in file lab3b.s
   Uses
      None
Comment: GPIO_PORTF_CR_R unused
GPIO_PORTF_DATA_R 400253FC

Symbol: GPIO_PORTF_DATA_R
   Definitions
      At line 111 in file lab3b.s
   Uses
      At line 25 in file lab3b.s
Comment: GPIO_PORTF_DATA_R used once
GPIO_PORTF_DEN_R 4002551C



ARM Macro Assembler    Page 4 Alphabetic symbol ordering
Absolute symbols


Symbol: GPIO_PORTF_DEN_R
   Definitions
      At line 114 in file lab3b.s
   Uses
      None
Comment: GPIO_PORTF_DEN_R unused
GPIO_PORTF_DIR_R 40025400

Symbol: GPIO_PORTF_DIR_R
   Definitions
      At line 110 in file lab3b.s
   Uses
      None
Comment: GPIO_PORTF_DIR_R unused
GPIO_PORTF_LOCK_R 40025520

Symbol: GPIO_PORTF_LOCK_R
   Definitions
      At line 115 in file lab3b.s
   Uses
      None
Comment: GPIO_PORTF_LOCK_R unused
GPIO_PORTF_PCTL_R 4002552C

Symbol: GPIO_PORTF_PCTL_R
   Definitions
      At line 118 in file lab3b.s
   Uses
      None
Comment: GPIO_PORTF_PCTL_R unused
GPIO_PORTF_PUR_R 40025510

Symbol: GPIO_PORTF_PUR_R
   Definitions
      At line 113 in file lab3b.s
   Uses
      None
Comment: GPIO_PORTF_PUR_R unused
GPIO_PUR_OFFSET 00000510

Symbol: GPIO_PUR_OFFSET
   Definitions
      At line 176 in file lab3b.s
   Uses
      At line 285 in file lab3b.s
Comment: GPIO_PUR_OFFSET used once
GREEN 00000008

Symbol: GREEN
   Definitions
      At line 19 in file lab3b.s
   Uses
      None
Comment: GREEN unused
PORT_A_MASK 000000FC

Symbol: PORT_A_MASK
   Definitions



ARM Macro Assembler    Page 5 Alphabetic symbol ordering
Absolute symbols

      At line 164 in file lab3b.s
   Uses
      At line 229 in file lab3b.s
      At line 336 in file lab3b.s

PORT_B_MASK 000000FD

Symbol: PORT_B_MASK
   Definitions
      At line 165 in file lab3b.s
   Uses
      At line 27 in file lab3b.s
      At line 57 in file lab3b.s
      At line 234 in file lab3b.s
      At line 337 in file lab3b.s

PORT_C_MASK 00000030

Symbol: PORT_C_MASK
   Definitions
      At line 166 in file lab3b.s
   Uses
      At line 239 in file lab3b.s
      At line 337 in file lab3b.s

PORT_D_MASK 000000CC

Symbol: PORT_D_MASK
   Definitions
      At line 167 in file lab3b.s
   Uses
      At line 244 in file lab3b.s
      At line 338 in file lab3b.s

PORT_E_MASK 00000037

Symbol: PORT_E_MASK
   Definitions
      At line 168 in file lab3b.s
   Uses
      At line 32 in file lab3b.s
      At line 61 in file lab3b.s
      At line 249 in file lab3b.s
      At line 338 in file lab3b.s

PORT_F_MASK 0000000E

Symbol: PORT_F_MASK
   Definitions
      At line 169 in file lab3b.s
   Uses
      At line 254 in file lab3b.s
      At line 339 in file lab3b.s

RED 00000002

Symbol: RED
   Definitions
      At line 17 in file lab3b.s



ARM Macro Assembler    Page 6 Alphabetic symbol ordering
Absolute symbols

   Uses
      None
Comment: RED unused
SHORTDELAYCOUNT 00086470

Symbol: SHORTDELAYCOUNT
   Definitions
      At line 37 in file lab3b.s
   Uses
      At line 43 in file lab3b.s
Comment: SHORTDELAYCOUNT used once
SW1 00000010

Symbol: SW1
   Definitions
      At line 20 in file lab3b.s
   Uses
      None
Comment: SW1 unused
SW2 00000001

Symbol: SW2
   Definitions
      At line 21 in file lab3b.s
   Uses
      None
Comment: SW2 unused
SYSCTL_HBCTL 400FE06C

Symbol: SYSCTL_HBCTL
   Definitions
      At line 183 in file lab3b.s
   Uses
      None
Comment: SYSCTL_HBCTL unused
SYSCTL_RCGCGPIO_R 400FE608

Symbol: SYSCTL_RCGCGPIO_R
   Definitions
      At line 186 in file lab3b.s
   Uses
      At line 201 in file lab3b.s
Comment: SYSCTL_RCGCGPIO_R used once
39 symbols
386 symbols in table
